{"version":3,"sources":["../src/ctrl.js"],"names":["MetricsPanelCtrl","_","kbn","TimeSeries","d3","panelDefaults","legend","show","links","datasource","maxDataPoints","interval","targets","cacheTimeout","nullPointMode","aliasColors","format","valueName","strokeWidth","fontSize","width","height","fixedWidth","fixedHeight","colorSet","colorSch","GroupedBarChartCtrl","$scope","$injector","$rootScope","hiddenSeries","data","defaults","panel","setPanelSize","events","on","onInitEditMode","bind","onDataReceived","onDataError","onPanelSizeChanged","addEditorTab","isFromUI","h","Math","ceil","w","gridPos","x","y","updateGridPos","render","subItem","value","forEach","push","d","color","dataList","o","groupBy","rows","e","forOwn","i","t","sta","sum","tid","map","s","reduce","res","label","sort","a","b","decimalInfo","getDecimalsForValue","formatFunc","valueFormats","decimals","scaledDecimals","scope","elem","attrs","ctrl","groupedBarChart","opts","margin","showLegend","element","find","options","union","keys","filter","k","valores","name","length","scale","ordinal","range","category20","draw","select","html","svg","append","attr","left","right","top","bottom","createScales","addAxes","addTooltips","addBar","addLegend","x0","rangeRoundBands","x1","linear","xAxis","axis","tickSize","orient","yAxis","domain","rangeBand","max","call","style","text","self","bar","selectAll","enter","barC","rgb","darker","tooltip","event","pageX","pageY","slice","transition","duration","delay","onRender","Chart","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAQA,4B,kBAAAA,gB;;AACDC,a;;AACAC,e;;AACAC,sB;;AACKC,c;;;;;;;;;;;;;;;;;;;;;AAGNC,yB,GAAgB;AAClBC,wBAAQ;AACJC,0BAAM;AADF,iBADU;AAIlBC,uBAAO,EAJW;AAKlBC,4BAAY,IALM;AAMlBC,+BAAe,CANG;AAOlBC,0BAAU,IAPQ;AAQlBC,yBAAS,CAAC,EAAD,CARS;AASlBC,8BAAc,IATI;AAUlBC,+BAAe,WAVG;AAWlBC,6BAAa,EAXK;AAYlBC,wBAAQ,OAZU;AAalBC,2BAAW,SAbO;AAclBC,6BAAa,CAdK;AAelBC,0BAAU,KAfQ;AAgBlBC,uBAAO,GAhBW;AAiBlBC,wBAAQ,GAjBU;AAkBlBC,4BAAY,GAlBM;AAmBlBC,6BAAa,GAnBK;AAoBlBC,0BAAU,EApBQ;AAqBlBC,0BAAU;AArBQ,a;;2CAwBTC,mB;;;AAET,6CAAYC,MAAZ,EAAoBC,SAApB,EAA+BC,UAA/B,EAA2C;AAAA;;AAAA,0JACjCF,MADiC,EACzBC,SADyB;;AAEvC,0BAAKC,UAAL,GAAkBA,UAAlB;AACA,0BAAKC,YAAL,GAAoB,EAApB;AACA,0BAAKC,IAAL,GAAY,IAAZ;;AAEA9B,sBAAE+B,QAAF,CAAW,MAAKC,KAAhB,EAAuB5B,aAAvB;AACA,0BAAK6B,YAAL;;AAEA,0BAAKC,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKC,cAAL,CAAoBC,IAApB,OAAjC;AACA,0BAAKH,MAAL,CAAYC,EAAZ,CAAe,eAAf,EAAgC,MAAKG,cAAL,CAAoBD,IAApB,OAAhC;AACA,0BAAKH,MAAL,CAAYC,EAAZ,CAAe,oBAAf,EAAqC,MAAKG,cAAL,CAAoBD,IAApB,OAArC;AACA,0BAAKH,MAAL,CAAYC,EAAZ,CAAe,YAAf,EAA6B,MAAKI,WAAL,CAAiBF,IAAjB,OAA7B;AACA,0BAAKH,MAAL,CAAYC,EAAZ,CAAe,oBAAf,EAAqC,MAAKK,kBAAL,CAAwBH,IAAxB,OAArC;AAbuC;AAc1C;;;;qDAEgB;AACb,6BAAKI,YAAL,CAAkB,SAAlB,EAA6B,mEAA7B,EAAkG,CAAlG;AACA,6BAAKA,YAAL,CAAkB,QAAlB,EAA4B,mEAA5B,EAAiG,CAAjG;AACH;;;iDAEYC,Q,EAAU;AACnB,4BAAIC,IAAIC,KAAKC,IAAL,CAAU,KAAKb,KAAL,CAAWV,WAAX,GAAyB,EAAnC,CAAR;AACA,4BAAIwB,IAAIF,KAAKC,IAAL,CAAU,KAAKb,KAAL,CAAWX,UAAX,GAAwB,EAAlC,CAAR;AACA,4BAAIqB,QAAJ,EAAc;AACV;AACA,gCAAII,MAAM,KAAKd,KAAL,CAAWe,OAAX,CAAmBD,CAAzB,IAA8BH,MAAM,KAAKX,KAAL,CAAWe,OAAX,CAAmBJ,CAA3D,EAA8D;AAC1D,oCAAII,UAAU,EAACC,GAAG,CAAJ,EAAOC,GAAG,CAAV,EAAaH,GAAG,CAAhB,EAAmBH,GAAG,CAAtB,EAAd;AACAI,wCAAQJ,CAAR,GAAYA,CAAZ;AACAI,wCAAQD,CAAR,GAAYA,CAAZ;AACA,qCAAKd,KAAL,CAAWkB,aAAX,CAAyBH,OAAzB;AACH;AACJ,yBARD,MAQO;AACH;AACA,gCAAID,MAAM,KAAKd,KAAL,CAAWe,OAAX,CAAmBD,CAAzB,IAA8BH,MAAM,KAAKX,KAAL,CAAWe,OAAX,CAAmBJ,CAA3D,EAA8D;AAC1D,qCAAKX,KAAL,CAAWV,WAAX,GAAyB,KAAKU,KAAL,CAAWe,OAAX,CAAmBJ,CAAnB,GAAuB,EAAhD;AACA,qCAAKX,KAAL,CAAWX,UAAX,GAAwB,KAAKW,KAAL,CAAWe,OAAX,CAAmBD,CAAnB,GAAuB,EAA/C;AACH;AACJ;AACD,6BAAKd,KAAL,CAAWZ,MAAX,GAAqB,KAAKY,KAAL,CAAWV,WAAX,GAAyB,IAA9C;AACA,6BAAKU,KAAL,CAAWb,KAAX,GAAoB,KAAKa,KAAL,CAAWX,UAAX,GAAwB,IAA5C;AACH;;;uDAEkBqB,Q,EAAU;AACzB,6BAAKT,YAAL,CAAkBS,QAAlB;AACA,6BAAKS,MAAL;AACH;;;kDAEaC,O,EAAS;AACnB,6BAAKpB,KAAL,CAAWjB,MAAX,GAAoBqC,QAAQC,KAA5B;AACA,6BAAKF,MAAL;AACH;;;kDAEa;AACV,6BAAKA,MAAL;AACH;;;qDAEgB;AAAA;;AACb,6BAAKnB,KAAL,CAAWR,QAAX,GAAsB,EAAtB;AACA,6BAAKQ,KAAL,CAAWT,QAAX,CAAoB+B,OAApB,CAA4B;AAAA,mCAAG,OAAKtB,KAAL,CAAWR,QAAX,CAAoB+B,IAApB,CAAyBC,EAAEC,KAA3B,CAAH;AAAA,yBAA5B;AACA,6BAAKN,MAAL;AACH;;;mDAEcO,Q,EAAU;AACrB,4BAAIC,IAAI3D,EAAE4D,OAAF,CAAUF,SAAS,CAAT,EAAYG,IAAtB,EAA4B;AAAA,mCAAGC,EAAE,CAAF,CAAH;AAAA,yBAA5B,CAAR;AACA9D,0BAAE+D,MAAF,CAASJ,CAAT,EAAY,UAACG,CAAD,EAAIE,CAAJ,EAAQ;AAChB,gCAAIC,IAAIjE,EAAE4D,OAAF,CAAUE,CAAV,EAAa;AAAA,uCAAKI,IAAI,CAAJ,CAAL;AAAA,6BAAb,CAAR;AACAP,8BAAEK,CAAF,IAAOhE,EAAE+D,MAAF,CAASE,CAAT,EAAY,UAACE,GAAD,EAAMC,GAAN,EAAY;AAACH,kCAAEG,GAAF,IAASD,IAAIE,GAAJ,CAAQ;AAAA,2CAAGC,EAAE,CAAF,CAAH;AAAA,iCAAR,EAAiBC,MAAjB,CAAwB,UAACtB,CAAD,EAAGD,CAAH;AAAA,2CAAOC,IAAED,CAAT;AAAA,iCAAxB,CAAT;AAA6C,6BAAtE,CAAP;AACH,yBAHD;;AAKA,4BAAIwB,MAAM,EAAV;AACAxE,0BAAE+D,MAAF,CAASJ,CAAT,EAAY,UAACG,CAAD,EAAIE,CAAJ,EAAS;AACjBF,8BAAEW,KAAF,GAAUT,CAAV;AACAQ,gCAAIjB,IAAJ,CAASO,CAAT;AACH,yBAHD;AAIA,6BAAKhC,IAAL,GAAY0C,IAAIE,IAAJ,CAAS,UAACC,CAAD,EAAIC,CAAJ,EAAQ;AAAC,mCAAQD,EAAEF,KAAF,GAAQG,EAAEH,KAAX,GAAkB,CAAC,CAAnB,GAAuBG,EAAEH,KAAF,GAAQE,EAAEF,KAAX,GAAkB,CAAlB,GAAoB,CAAjD;AAAoD,yBAAtE,CAAZ;AACA,6BAAKtB,MAAL;AACH;;;gDAEWE,K,EAAO;AACf,4BAAIwB,cAAc,KAAKC,mBAAL,CAAyBzB,KAAzB,CAAlB;AACA,4BAAI0B,aAAa9E,IAAI+E,YAAJ,CAAiB,KAAKhD,KAAL,CAAWjB,MAA5B,CAAjB;AACA,4BAAIgE,UAAJ,EAAgB;AACZ,mCAAOA,WAAW1B,KAAX,EAAkBwB,YAAYI,QAA9B,EAAwCJ,YAAYK,cAApD,CAAP;AACH;AACD,+BAAO7B,KAAP;AACH;;;yCAEI8B,K,EAAOC,I,EAAMC,K,EAAOC,I,EAAM;AAAA,4BACrBC,eADqB;AAEvB,qDAAYC,IAAZ,EAAkB;AAAA;;AAAA;;AACd,qCAAK1D,IAAL,GAAY0D,KAAK1D,IAAjB;AACA,qCAAK2D,MAAL,GAAcD,KAAKC,MAAnB;AACA,qCAAKtE,KAAL,GAAaqE,KAAKrE,KAAlB;AACA,qCAAKC,MAAL,GAAcoE,KAAKpE,MAAnB;AACA,qCAAKsE,UAAL,GAAkBF,KAAKnF,MAAvB;AACA,qCAAKsF,OAAL,GAAeP,KAAKQ,IAAL,CAAUJ,KAAKG,OAAf,EAAwB,CAAxB,CAAf;AACA,qCAAKE,OAAL,GAAe,EAAf;AACA,qCAAK/D,IAAL,CAAUwB,OAAV,CAAkB,aAAK;AACnB,2CAAKuC,OAAL,GAAe7F,EAAE8F,KAAF,CAAQ,OAAKD,OAAb,EAAsB7F,EAAE+F,IAAF,CAAOvC,CAAP,EAAUwC,MAAV,CAAiB;AAAA,+CAAKC,MAAM,OAAN,IAAiBA,MAAO,SAA7B;AAAA,qCAAjB,CAAtB,CAAf;AACH,iCAFD;AAGA,qCAAKnE,IAAL,CAAUwB,OAAV,CAAkB,aAAK;AACnBE,sCAAE0C,OAAF,GAAY,OAAKL,OAAL,CAAaxB,GAAb,CAAiB,gBAAQ;AACjC,+CAAO,EAAC8B,MAAMA,IAAP,EAAa9C,OAAOG,EAAE2C,IAAF,KAAW,CAA/B,EAAP;AACH,qCAFW,CAAZ;AAGH,iCAJD;AAKA,oCAAGX,KAAK/B,KAAL,CAAW2C,MAAX,IAAqB,CAAxB,EAA2B;AACvB,yCAAK3C,KAAL,GAAatD,GAAGkG,KAAH,CAASC,OAAT,GACRC,KADQ,CACFpG,GAAGkG,KAAH,CAASG,UAAT,GAAsBD,KAAtB,EADE,CAAb;AAEH,iCAHD,MAGO;AACH,yCAAK9C,KAAL,GAAatD,GAAGkG,KAAH,CAASC,OAAT,GACRC,KADQ,CACFf,KAAK/B,KADH,CAAb;AAEH;;AAED,qCAAKgD,IAAL;AACH;;AA3BsB;AAAA;AAAA,uDA6BhB;AACHtG,uCAAGuG,MAAH,CAAU,KAAKf,OAAf,EAAwBgB,IAAxB,CAA6B,EAA7B;AACA,yCAAKC,GAAL,GAAWzG,GAAGuG,MAAH,CAAU,KAAKf,OAAf,EAAwBkB,MAAxB,CAA+B,KAA/B,CAAX;AACA,yCAAKD,GAAL,CAASE,IAAT,CAAc,OAAd,EAAuB,KAAK3F,KAAL,GAAa,KAAKsE,MAAL,CAAYsB,IAAzB,GAAgC,KAAKtB,MAAL,CAAYuB,KAAnE,EACSF,IADT,CACc,QADd,EACwB,KAAK1F,MAAL,GAAc,KAAKqE,MAAL,CAAYwB,GAA1B,GAAgC,KAAKxB,MAAL,CAAYyB,MADpE,EAESL,MAFT,CAEgB,GAFhB,EAGSC,IAHT,CAGc,WAHd,EAG2B,eAAe,KAAKrB,MAAL,CAAYsB,IAA3B,GAAkC,GAAlC,GAAwC,KAAKtB,MAAL,CAAYwB,GAApD,GAA0D,GAHrF;;AAKA,yCAAKE,YAAL;AACA,yCAAKC,OAAL;AACA,yCAAKC,WAAL;AACA,yCAAKC,MAAL;AACA,wCAAG,KAAK5B,UAAR,EAAoB,KAAK6B,SAAL;AACvB;AA1CsB;AAAA;AAAA,+DA4CR;AACX,yCAAKC,EAAL,GAAUrH,GAAGkG,KAAH,CAASC,OAAT,GACLmB,eADK,CACW,CAAC,CAAD,EAAI,KAAKtG,KAAT,CADX,EAC4B,EAD5B,CAAV;;AAGA,yCAAKuG,EAAL,GAAUvH,GAAGkG,KAAH,CAASC,OAAT,EAAV;;AAEA,yCAAKrD,CAAL,GAAS9C,GAAGkG,KAAH,CAASsB,MAAT,GACJpB,KADI,CACE,CAAC,KAAKnF,MAAN,EAAc,CAAd,CADF,CAAT;AAEH;AApDsB;AAAA;AAAA,0DAsDb;AACN,yCAAKwG,KAAL,GAAazH,GAAGyG,GAAH,CAAOiB,IAAP,GACRxB,KADQ,CACF,KAAKmB,EADH,EAERM,QAFQ,CAEC,CAFD,EAGRC,MAHQ,CAGD,QAHC,CAAb;;AAKA,yCAAKC,KAAL,GAAa7H,GAAGyG,GAAH,CAAOiB,IAAP,GACRxB,KADQ,CACF,KAAKpD,CADH,EAER8E,MAFQ,CAED,MAFC,CAAb;;AAIA,yCAAKP,EAAL,CAAQS,MAAR,CAAe,KAAKnG,IAAL,CAAUuC,GAAV,CAAc,aAAI;AAAE,+CAAOb,EAAEiB,KAAT;AAAiB,qCAArC,CAAf;AACA,yCAAKiD,EAAL,CAAQO,MAAR,CAAe,KAAKpC,OAApB,EAA6B4B,eAA7B,CAA6C,CAAC,CAAD,EAAI,KAAKD,EAAL,CAAQU,SAAR,EAAJ,CAA7C;AACA,yCAAKjF,CAAL,CAAOgF,MAAP,CAAc,CAAC,CAAD,EAAI9H,GAAGgI,GAAH,CAAO,KAAKrG,IAAZ,EAAkB,UAAS0B,CAAT,EAAY;AAAE,+CAAOrD,GAAGgI,GAAH,CAAO3E,EAAE0C,OAAT,EAAkB,aAAI;AAAE,mDAAO1C,EAAEH,KAAT;AAAiB,yCAAzC,CAAP;AAAoD,qCAApF,CAAJ,CAAd;;AAEA,yCAAKuD,GAAL,CAASC,MAAT,CAAgB,GAAhB,EACGC,IADH,CACQ,OADR,EACiB,QADjB,EAEGA,IAFH,CAEQ,WAFR,EAEqB,iBAAiB,KAAK1F,MAAtB,GAA+B,GAFpD,EAGGgH,IAHH,CAGQ,KAAKR,KAHb;;AAKA,yCAAKhB,GAAL,CAASC,MAAT,CAAgB,GAAhB,EACGC,IADH,CACQ,OADR,EACiB,QADjB,EAEGuB,KAFH,CAES,SAFT,EAEmB,GAFnB,EAGGD,IAHH,CAGQ,KAAKJ,KAHb,EAIGnB,MAJH,CAIU,MAJV,EAKGC,IALH,CAKQ,WALR,EAKqB,aALrB,EAMGA,IANH,CAMQ,GANR,EAMa,CANb,EAOGA,IAPH,CAOQ,IAPR,EAOc,OAPd,EAQGuB,KARH,CAQS,aART,EAQwB,KARxB,EASGA,KATH,CASS,aATT,EASuB,MATvB,EAUGC,IAVH,CAUQ,OAVR;AAWH;AApFsB;AAAA;AAAA,yDAsFd;AAAA;;AACL,wCAAIC,OAAO,IAAX;AACA,yCAAKC,GAAL,GAAW,KAAK5B,GAAL,CAAS6B,SAAT,CAAmB,MAAnB,EACN3G,IADM,CACD,KAAKA,IADJ,EAEN4G,KAFM,GAEE7B,MAFF,CAES,GAFT,EAGNC,IAHM,CAGD,OAHC,EAGQ,GAHR,EAINA,IAJM,CAID,WAJC,EAIY,aAAI;AACnB,8DAAoB,OAAKU,EAAL,CAAQhE,EAAEiB,KAAV,CAApB;AACH,qCANM,CAAX;;AAQA,yCAAKkE,IAAL,GAAY,KAAKH,GAAL,CAASC,SAAT,CAAmB,MAAnB,EACP3G,IADO,CACF,aAAI;AAAE,+CAAO0B,EAAE0C,OAAT;AAAmB,qCADvB,EAEPwC,KAFO,EAAZ;;AAIA,yCAAKC,IAAL,CAAU9B,MAAV,CAAiB,MAAjB,EACKC,IADL,CACU,OADV,EACmB,KAAKY,EAAL,CAAQQ,SAAR,EADnB,EAEKpB,IAFL,CAEU,GAFV,EAEe,aAAI;AAAE,+CAAO,OAAKY,EAAL,CAAQlE,EAAE2C,IAAV,CAAP;AAAwB,qCAF7C,EAGKW,IAHL,CAGU,GAHV,EAGe,aAAI;AAAE,+CAAO,OAAK7D,CAAL,CAAOO,EAAEH,KAAT,CAAP;AAAwB,qCAH7C,EAIKyD,IAJL,CAIU,QAJV,EAIoB,aAAI;AAAE,+CAAO,OAAK1F,MAAL,GAAc,OAAK6B,CAAL,CAAOO,EAAEH,KAAT,CAArB;AAAsC,qCAJhE,EAKKgF,KALL,CAKW,MALX,EAKmB,aAAI;AAAE,+CAAO,OAAK5E,KAAL,CAAWD,EAAE2C,IAAb,CAAP;AAA2B,qCALpD,EAMKhE,EANL,CAMQ,WANR,EAMqB,UAASqB,CAAT,EAAY;AACzB;AACA;AACA;AACA;AACA,4CAAIC,QAAQ8E,KAAK9E,KAAL,CAAWD,EAAE2C,IAAb,CAAZ;AACA;AACAhG,2CAAGuG,MAAH,CAAU,IAAV,EAAgB2B,KAAhB,CAAsB,MAAtB,EAA8BlI,GAAGyI,GAAH,CAAOnF,KAAP,EAAcoF,MAAd,CAAqB,CAArB,CAA9B;AACAN,6CAAKO,OAAL,CACKT,KADL,CACW,SADX,EACsB,GADtB,EAEKA,KAFL,CAEW,MAFX,EAEoBU,MAAMC,KAAN,GAAc,EAAf,GAAqB,IAFxC,EAGKX,KAHL,CAGW,KAHX,EAGmBU,MAAME,KAAN,GAAc,EAAf,GAAqB,IAHvC,EAIKtC,IAJL,cAIqBnD,EAAE2C,IAJvB,6CAIiE3C,EAAEH,KAJnE;AAKH,qCAnBL,EAoBKlB,EApBL,CAoBQ,UApBR,EAoBoB,UAASqB,CAAT,EAAY;AACxBrD,2CAAGuG,MAAH,CAAU,IAAV,EAAgB2B,KAAhB,CAAsB,MAAtB,EAA8BE,KAAK9E,KAAL,CAAWD,EAAE2C,IAAb,CAA9B;AACAoC,6CAAKO,OAAL,CAAaT,KAAb,CAAmB,SAAnB,EAA8B,CAA9B;AACH,qCAvBL;AAwBH;AA5HsB;AAAA;AAAA,4DA8HX;AACR,yCAAKhI,MAAL,GAAc,KAAKuG,GAAL,CAAS6B,SAAT,CAAmB,SAAnB,EACT3G,IADS,CACJ,KAAK+D,OAAL,CAAaqD,KAAb,EADI,EAETR,KAFS,GAED7B,MAFC,CAEM,GAFN,EAGTC,IAHS,CAGJ,OAHI,EAGK,QAHL,EAITA,IAJS,CAIJ,WAJI,EAIS,UAACtD,CAAD,EAAIQ,CAAJ,EAAS;AAAE,gEAAsBA,IAAE,EAAxB;AAAgC,qCAJpD,CAAd;;AAMA,yCAAK3D,MAAL,CAAYwG,MAAZ,CAAmB,MAAnB,EACKC,IADL,CACU,GADV,EACe,KAAK3F,KAAL,GAAW,GAAX,GAAiB,EADhC,EAEK2F,IAFL,CAEU,OAFV,EAEmB,EAFnB,EAGKA,IAHL,CAGU,QAHV,EAGoB,EAHpB,EAIKuB,KAJL,CAIW,MAJX,EAImB,KAAK5E,KAJxB;;AAMA,yCAAKpD,MAAL,CAAYwG,MAAZ,CAAmB,MAAnB,EACKC,IADL,CACU,GADV,EACe,KAAK3F,KAAL,GAAW,GAAX,GAAiB,EADhC,EAEK2F,IAFL,CAEU,GAFV,EAEe,CAFf,EAGKA,IAHL,CAGU,IAHV,EAGgB,OAHhB,EAIKuB,KAJL,CAIW,aAJX,EAI0B,KAJ1B,EAKKC,IALL,CAKU,aAAI;AAAE,+CAAO9E,CAAP;AAAW,qCAL3B;;AAOA,yCAAKnD,MAAL,CAAY8I,UAAZ,GAAyBC,QAAzB,CAAkC,GAAlC,EAAuCC,KAAvC,CAA6C,UAAS7F,CAAT,EAAWQ,CAAX,EAAa;AAAE,+CAAO,OAAO,MAAMA,CAApB;AAAwB,qCAApF,EAAsFqE,KAAtF,CAA4F,SAA5F,EAAsG,GAAtG;AACH;AAnJsB;AAAA;AAAA,8DAqJT;AACV,yCAAKS,OAAL,GAAe3I,GAAGuG,MAAH,CAAU,MAAV,EAAkBG,MAAlB,CAAyB,KAAzB,EACMC,IADN,CACW,OADX,EACoB,SADpB,EAEMuB,KAFN,CAEY,SAFZ,EAEuB,CAFvB,CAAf;AAGH;AAzJsB;;AAAA;AAAA;;AA4J3B,iCAASiB,QAAT,GAAoB;AAChB,gCAAG,CAAChE,KAAKxD,IAAT,EAAe;;AAEf,gCAAIyH,QAAQ,IAAIhE,eAAJ,CAAoB;AAC5BzD,sCAAMwD,KAAKxD,IADiB;AAE5B2D,wCAAQ,EAACwB,KAAK,EAAN,EAAUF,MAAM,EAAhB,EAAoBG,QAAQ,EAA5B,EAAgCF,OAAO,EAAvC,EAFoB;AAG5BrB,yCAAS,QAHmB;AAI5BxE,uCAAOmE,KAAKtD,KAAL,CAAWb,KAJU;AAK5BC,wCAAQkE,KAAKtD,KAAL,CAAWZ,MALS;AAM5Bf,wCAAQiF,KAAKtD,KAAL,CAAW3B,MAAX,CAAkBC,IANE;AAO5BmD,uCAAO6B,KAAKtD,KAAL,CAAWR;AAPU,6BAApB,CAAZ;;AAUA8D,iCAAKtD,KAAL,CAAWT,QAAX,GAAsB,EAAtB;AACAgI,kCAAM1D,OAAN,CAAcvC,OAAd,CAAsB,aAAI;AACtBgC,qCAAKtD,KAAL,CAAWT,QAAX,CAAoBgC,IAApB,CAAyB,EAAC+E,MAAM9E,CAAP,EAAUC,OAAO8F,MAAM9F,KAAN,CAAYD,CAAZ,CAAjB,EAAzB;AACH,6BAFD;AAGH;;AAED,6BAAKtB,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,YAAW;AAChCmH;AACH,yBAFD;AAGH;;;;cA5QoCvJ,gB;;;;AA+QzC0B,gCAAoB+H,WAApB,GAAkC,sBAAlC","file":"ctrl.js","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport kbn from 'app/core/utils/kbn';\nimport TimeSeries from 'app/core/time_series';\nimport * as d3 from './external/d3.v3.min';\nimport './css/groupedBarChart.css!';\n\nconst panelDefaults = {\n    legend: {\n        show: true\n    },\n    links: [],\n    datasource: null,\n    maxDataPoints: 3,\n    interval: null,\n    targets: [{}],\n    cacheTimeout: null,\n    nullPointMode: 'connected',\n    aliasColors: {},\n    format: 'short',\n    valueName: 'current',\n    strokeWidth: 1,\n    fontSize: '80%',\n    width: 960,\n    height: 500,\n    fixedWidth: 960,\n    fixedHeight: 500,\n    colorSet: [],\n    colorSch: []\n};\n\nexport class GroupedBarChartCtrl extends MetricsPanelCtrl {\n\n    constructor($scope, $injector, $rootScope) {\n        super($scope, $injector);\n        this.$rootScope = $rootScope;\n        this.hiddenSeries = {};\n        this.data = null;\n\n        _.defaults(this.panel, panelDefaults);\n        this.setPanelSize();\n\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n        this.events.on('data-received', this.onDataReceived.bind(this));\n        this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n        this.events.on('data-error', this.onDataError.bind(this));\n        this.events.on('panel-size-changed', this.onPanelSizeChanged.bind(this));\n    }\n\n    onInitEditMode() {\n        this.addEditorTab('Options', 'public/plugins/grafana-groupedbarchart-panel/partials/editor.html', 2);\n        this.addEditorTab('Colors', 'public/plugins/grafana-groupedbarchart-panel/partials/colors.html', 3);\n    }\n\n    setPanelSize(isFromUI) {\n        let h = Math.ceil(this.panel.fixedHeight / 30);\n        let w = Math.ceil(this.panel.fixedWidth / 50);\n        if (isFromUI) {\n            // Set panel width and height from panel UI\n            if (w !== this.panel.gridPos.w || h !== this.panel.gridPos.h) {\n                let gridPos = {x: 0, y: 0, w: 0, h: 0};\n                gridPos.h = h;\n                gridPos.w = w;\n                this.panel.updateGridPos(gridPos);\n            }\n        } else {\n            // Read panel width and height from default panel\n            if (w !== this.panel.gridPos.w || h !== this.panel.gridPos.h) {\n                this.panel.fixedHeight = this.panel.gridPos.h * 30;\n                this.panel.fixedWidth = this.panel.gridPos.w * 50;\n            }\n        }\n        this.panel.height =  this.panel.fixedHeight * 0.95;\n        this.panel.width =  this.panel.fixedWidth * 0.85;\n    }\n\n    onPanelSizeChanged(isFromUI) {\n        this.setPanelSize(isFromUI);\n        this.render();\n    }\n\n    setUnitFormat(subItem) {\n        this.panel.format = subItem.value;\n        this.render();\n    }\n\n    onDataError() {\n        this.render();\n    }\n\n    updateColorSet() {\n        this.panel.colorSch = [];\n        this.panel.colorSet.forEach(d=>this.panel.colorSch.push(d.color));\n        this.render();\n    }\n\n    onDataReceived(dataList) {\n        let o = _.groupBy(dataList[0].rows, e=>e[0]);\n        _.forOwn(o, (e, i)=>{\n            let t = _.groupBy(e, sta=>sta[1]);\n            o[i] = _.forOwn(t, (sum, tid)=>{t[tid] = sum.map(s=>s[2]).reduce((y,x)=>y+x)})\n        });\n\n        let res = [];\n        _.forOwn(o, (e, i)=> {\n            e.label = i;\n            res.push(e);\n        });\n        this.data = res.sort((a, b)=>{return (a.label>b.label)?-1:((b.label>a.label)?1:0)});\n        this.render();\n    }\n\n    formatValue(value) {\n        let decimalInfo = this.getDecimalsForValue(value);\n        let formatFunc = kbn.valueFormats[this.panel.format];\n        if (formatFunc) {\n            return formatFunc(value, decimalInfo.decimals, decimalInfo.scaledDecimals);\n        }\n        return value;\n    }\n\n    link(scope, elem, attrs, ctrl) {\n        class groupedBarChart {\n            constructor(opts) {\n                this.data = opts.data;\n                this.margin = opts.margin;\n                this.width = opts.width;\n                this.height = opts.height;\n                this.showLegend = opts.legend;\n                this.element = elem.find(opts.element)[0];\n                this.options = [];\n                this.data.forEach(d => {\n                    this.options = _.union(this.options, _.keys(d).filter(k => k !== 'label' && k !==  'valores'));\n                });\n                this.data.forEach(d => {\n                    d.valores = this.options.map(name => {\n                        return {name: name, value: d[name] || 0};\n                    });\n                });\n                if(opts.color.length == 0) {\n                    this.color = d3.scale.ordinal()\n                        .range(d3.scale.category20().range());\n                } else {\n                    this.color = d3.scale.ordinal()\n                        .range(opts.color);\n                }\n\n                this.draw();\n            }\n\n            draw() {\n                d3.select(this.element).html(\"\");\n                this.svg = d3.select(this.element).append('svg');\n                this.svg.attr('width', this.width + this.margin.left + this.margin.right)\n                        .attr(\"height\", this.height + this.margin.top + this.margin.bottom)\n                        .append(\"g\")\n                        .attr(\"transform\", \"translate(\" + this.margin.left + \",\" + this.margin.top + \")\");\n\n                this.createScales();\n                this.addAxes();\n                this.addTooltips();\n                this.addBar();\n                if(this.showLegend) this.addLegend();\n            }\n\n            createScales() {\n                this.x0 = d3.scale.ordinal()\n                    .rangeRoundBands([0, this.width], .5);\n\n                this.x1 = d3.scale.ordinal();\n\n                this.y = d3.scale.linear()\n                    .range([this.height, 0]);\n            }\n\n            addAxes() {\n                this.xAxis = d3.svg.axis()\n                    .scale(this.x0)\n                    .tickSize(0)\n                    .orient(\"bottom\");\n\n                this.yAxis = d3.svg.axis()\n                    .scale(this.y)\n                    .orient(\"left\");\n\n                this.x0.domain(this.data.map(d=> { return d.label; }));\n                this.x1.domain(this.options).rangeRoundBands([0, this.x0.rangeBand()]);\n                this.y.domain([0, d3.max(this.data, function(d) { return d3.max(d.valores, d=> { return d.value; }); })]);\n\n                this.svg.append(\"g\")\n                  .attr(\"class\", \"x axis\")\n                  .attr(\"transform\", \"translate(0,\" + this.height + \")\")\n                  .call(this.xAxis);\n\n                this.svg.append(\"g\")\n                  .attr(\"class\", \"y axis\")\n                  .style('opacity','0')\n                  .call(this.yAxis)\n                  .append(\"text\")\n                  .attr(\"transform\", \"rotate(-90)\")\n                  .attr(\"y\", 6)\n                  .attr(\"dy\", \".71em\")\n                  .style(\"text-anchor\", \"end\")\n                  .style('font-weight','bold')\n                  .text(\"Value\");\n            }\n\n            addBar() {\n                let self = this;\n                this.bar = this.svg.selectAll('.bar')\n                    .data(this.data)\n                    .enter().append('g')\n                    .attr('class', 'g')\n                    .attr('transform', d=> {\n                        return `translate(${this.x0(d.label)}, 0)`;\n                    });\n\n                this.barC = this.bar.selectAll('rect')\n                    .data(d=> { return d.valores; })\n                    .enter();\n\n                this.barC.append('rect')\n                    .attr('width', this.x1.rangeBand())\n                    .attr('x', d=> { return this.x1(d.name);})\n                    .attr('y', d=> { return this.y(d.value);})\n                    .attr('height', d=> { return this.height - this.y(d.value);})\n                    .style('fill', d=> { return this.color(d.name);})\n                    .on(\"mouseover\", function(d) {\n                        // this.tips = d3.select(this).append('div').attr('class', 'toolTip')\n                        // this.tips.style('left', `${10}px`);\n                        // this.tips.style('top', `${15}px`);\n                        // this.tips.style('display', \"inline-block\");\n                        let color = self.color(d.name);\n                        // this.tips.html(`${d.name} ,  ${d.value}`);\n                        d3.select(this).style(\"fill\", d3.rgb(color).darker(2));\n                        self.tooltip\n                            .style('opacity', 0.9)\n                            .style('left', (event.pageX - 34) + 'px')\n                            .style('top', (event.pageY - 12) + 'px')\n                            .html(`<strong>${d.name}:</strong><span style='color:red'> ${d.value}</span>`);\n                    })\n                    .on(\"mouseout\", function(d) {\n                        d3.select(this).style(\"fill\", self.color(d.name));\n                        self.tooltip.style('opacity', 0);\n                    });\n            }\n\n            addLegend() {\n                this.legend = this.svg.selectAll('.legend')\n                    .data(this.options.slice())\n                    .enter().append('g')\n                    .attr('class', 'legend')\n                    .attr('transform', (d, i)=> { return `translate(0,${i*20})`; });\n\n                this.legend.append('rect')\n                    .attr('x', this.width*1.1 - 18)\n                    .attr('width', 18)\n                    .attr('height', 18)\n                    .style('fill', this.color);\n\n                this.legend.append('text')\n                    .attr('x', this.width*1.1 - 24)\n                    .attr('y', 9)\n                    .attr('dy', '.35em')\n                    .style('text-anchor', 'end')\n                    .text(d=> { return d; });\n\n                this.legend.transition().duration(500).delay(function(d,i){ return 1300 + 100 * i; }).style(\"opacity\",\"1\");\n            }\n\n            addTooltips() {\n                this.tooltip = d3.select('body').append('div')\n                                    .attr('class', 'tooltip')\n                                    .style('opacity', 0);\n            }\n        }\n\n        function onRender() {\n            if(!ctrl.data) return;\n\n            let Chart = new groupedBarChart({\n                data: ctrl.data,\n                margin: {top: 10, left: 10, bottom: 10, right: 10},\n                element: '#chart',\n                width: ctrl.panel.width,\n                height: ctrl.panel.height,\n                legend: ctrl.panel.legend.show,\n                color: ctrl.panel.colorSch\n            });\n\n            ctrl.panel.colorSet = [];\n            Chart.options.forEach(d=> {\n                ctrl.panel.colorSet.push({text: d, color: Chart.color(d)});\n            });\n        }\n\n        this.events.on('render', function() {\n            onRender();\n        });\n    }\n}\n\nGroupedBarChartCtrl.templateUrl = 'partials/module.html';"]}