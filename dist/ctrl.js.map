{"version":3,"sources":["../src/ctrl.js"],"names":["MetricsPanelCtrl","_","kbn","TimeSeries","d3","panelDefaults","legend","show","links","datasource","maxDataPoints","interval","targets","cacheTimeout","nullPointMode","aliasColors","format","valueName","strokeWidth","fontSize","width","height","fixedWidth","fixedHeight","colorSet","colorSch","GroupedBarChartCtrl","$scope","$injector","$rootScope","hiddenSeries","data","defaults","panel","setPanelSize","events","on","onInitEditMode","bind","onDataReceived","onDataError","onPanelSizeChanged","addEditorTab","isFromUI","h","Math","ceil","w","gridPos","x","y","updateGridPos","render","subItem","value","forEach","push","d","color","dataList","length","rows","console","log","type","myData","legendColumn","legendFormat","vIndex","legendIndex","isUndefined","findColumnIndex","columns","labelIndex","map","r","o","groupBy","e","forOwn","i","t","sta","items","tid","max","s","res","label","sort","a","b","column","index","each","text","decimalInfo","getDecimalsForValue","formatFunc","valueFormats","decimals","scaledDecimals","scope","elem","attrs","ctrl","groupedBarChart","opts","margin","showLegend","element","find","options","union","keys","filter","k","valores","name","scale","ordinal","range","category20","draw","select","html","svg","append","attr","left","right","top","bottom","createScales","addAxes","addTooltips","addBar","addLegend","x0","rangeRoundBands","x1","linear","xAxis","axis","tickSize","orient","yAxis","domain","rangeBand","call","style","self","bar","selectAll","enter","barC","rgb","darker","tooltip","event","pageX","pageY","slice","transition","duration","delay","onRender","Chart","templateUrl"],"mappings":"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","file":"ctrl.js","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport kbn from 'app/core/utils/kbn';\nimport TimeSeries from 'app/core/time_series';\nimport * as d3 from './external/d3.v3.min';\nimport './css/groupedBarChart.css!';\n\nconst panelDefaults = {\n    legend: {\n        show: true\n    },\n    links: [],\n    datasource: null,\n    maxDataPoints: 3,\n    interval: null,\n    targets: [{}],\n    cacheTimeout: null,\n    nullPointMode: 'connected',\n    aliasColors: {},\n    format: 'short',\n    valueName: 'current',\n    strokeWidth: 1,\n    fontSize: '80%',\n    width: 960,\n    height: 500,\n    fixedWidth: 960,\n    fixedHeight: 500,\n    colorSet: [],\n    colorSch: []\n};\n\nexport class GroupedBarChartCtrl extends MetricsPanelCtrl {\n\n    constructor($scope, $injector, $rootScope) {\n        super($scope, $injector);\n        this.$rootScope = $rootScope;\n        this.hiddenSeries = {};\n        this.data = null;\n\n        _.defaults(this.panel, panelDefaults);\n        this.setPanelSize();\n\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n        this.events.on('data-received', this.onDataReceived.bind(this));\n        this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n        this.events.on('data-error', this.onDataError.bind(this));\n        this.events.on('panel-size-changed', this.onPanelSizeChanged.bind(this));\n    }\n\n    onInitEditMode() {\n        this.addEditorTab('Options', 'public/plugins/grafana-groupedbarchart-panel/partials/editor.html', 2);\n        this.addEditorTab('Colors', 'public/plugins/grafana-groupedbarchart-panel/partials/colors.html', 3);\n    }\n\n    setPanelSize(isFromUI) {\n        let h = Math.ceil(this.panel.fixedHeight / 30);\n        let w = Math.ceil(this.panel.fixedWidth / 50);\n        if (isFromUI) {\n            // Set panel width and height from panel UI\n            if (w !== this.panel.gridPos.w || h !== this.panel.gridPos.h) {\n                let gridPos = {x: 0, y: 0, w: 0, h: 0};\n                gridPos.h = h;\n                gridPos.w = w;\n                this.panel.updateGridPos(gridPos);\n            }\n        } else {\n            // Read panel width and height from default panel\n            if (w !== this.panel.gridPos.w || h !== this.panel.gridPos.h) {\n                this.panel.fixedHeight = this.panel.gridPos.h * 30;\n                this.panel.fixedWidth = this.panel.gridPos.w * 50;\n            }\n        }\n        this.panel.height =  this.panel.fixedHeight * 0.95;\n        this.panel.width =  this.panel.fixedWidth * 0.8;\n    }\n\n    onPanelSizeChanged(isFromUI) {\n        this.setPanelSize(isFromUI);\n        this.render();\n    }\n\n    setUnitFormat(subItem) {\n        this.panel.format = subItem.value;\n        this.render();\n    }\n\n    onDataError() {\n        this.render();\n    }\n\n    updateColorSet() {\n        this.panel.colorSch = [];\n        this.panel.colorSet.forEach(d=>this.panel.colorSch.push(d.color));\n        this.render();\n    }\n\n    onDataReceived(dataList) {\n        // only support table format and support 3 columns: label, legend, value\n        if (dataList.length < 1 || !dataList[0].rows || dataList[0].rows.length < 1) {\n            console.log('no data');\n            return;\n        }\n        if (dataList[0].type !== 'table') {\n            console.log('only support table format!');\n            return;\n        }\n        let myData = dataList[0].rows;\n        if (this.datasource.type === 'prometheus' || this.datasource.type === 'influxdb') {\n            // default takes 4 columns of data: time, label, legend, value\n            let legendColumn = this.panel.targets[0].legendFormat;\n            let vIndex = myData[0].length - 1;\n            let legendIndex = _.isUndefined(legendColumn) ? vIndex - 1 : this.findColumnIndex(dataList[0].columns, legendColumn);\n            let labelIndex = vIndex - legendIndex > 1 ? legendIndex + 1 : legendIndex - 1;\n            if (legendIndex < 0 || labelIndex < 0 || labelIndex >= vIndex) {\n                console.log('data length is invalid.');\n                return;\n            } else {\n                myData = dataList[0].rows.map(r => [r[labelIndex], r[legendIndex], r[vIndex]]);\n            }\n        }\n        let o = _.groupBy(myData, e=>e[0]);\n        _.forOwn(o, (e, i)=>{\n            let t = _.groupBy(e, sta=>sta[1]);\n            o[i] = _.forOwn(t, (items, tid)=>{t[tid] = _.max(items.map(s=>s[2]))})\n        });\n\n        let res = [];\n        _.forOwn(o, (e, i)=> {\n            e.label = i;\n            res.push(e);\n        });\n        this.data = res.sort((a, b)=>{return (a.label>b.label)?-1:((b.label>a.label)?1:0)});\n\n        this.render();\n    }\n\n    findColumnIndex(data, column) {\n        let index = -1;\n        _.each(data, (d,i) => {\n            if (d.text === column) {\n                index = i;\n            }\n        })\n        return index;\n    }\n\n    formatValue(value) {\n        let decimalInfo = this.getDecimalsForValue(value);\n        let formatFunc = kbn.valueFormats[this.panel.format];\n        if (formatFunc) {\n            return formatFunc(value, decimalInfo.decimals, decimalInfo.scaledDecimals);\n        }\n        return value;\n    }\n\n    link(scope, elem, attrs, ctrl) {\n        class groupedBarChart {\n            constructor(opts) {\n                this.data = opts.data;\n                this.margin = opts.margin;\n                this.width = opts.width;\n                this.height = opts.height;\n                this.showLegend = opts.legend;\n                this.element = elem.find(opts.element)[0];\n                this.options = [];\n                this.data.forEach(d => {\n                    this.options = _.union(this.options, _.keys(d).filter(k => k !== 'label' && k !==  'valores'));\n                });\n                this.data.forEach(d => {\n                    d.valores = this.options.map(name => {\n                        return {name: name, value: d[name] || 0};\n                    });\n                });\n                if(opts.color.length == 0) {\n                    this.color = d3.scale.ordinal()\n                        .range(d3.scale.category20().range());\n                } else {\n                    this.color = d3.scale.ordinal()\n                        .range(opts.color);\n                }\n\n                this.draw();\n            }\n\n            draw() {\n                d3.select(this.element).html(\"\");\n                this.svg = d3.select(this.element).append('svg');\n                this.svg.attr('width', this.width + this.margin.left + this.margin.right)\n                        .attr(\"height\", this.height + this.margin.top + this.margin.bottom)\n                        .append(\"g\")\n                        .attr(\"transform\", \"translate(\" + this.margin.left + \",\" + this.margin.top + \")\");\n\n                this.createScales();\n                this.addAxes();\n                this.addTooltips();\n                this.addBar();\n                if(this.showLegend) this.addLegend();\n            }\n\n            createScales() {\n                this.x0 = d3.scale.ordinal()\n                    .rangeRoundBands([0, this.width], .5);\n\n                this.x1 = d3.scale.ordinal();\n\n                this.y = d3.scale.linear()\n                    .range([this.height, 0]);\n            }\n\n            addAxes() {\n                this.xAxis = d3.svg.axis()\n                    .scale(this.x0)\n                    .tickSize(0)\n                    .orient(\"bottom\");\n\n                this.yAxis = d3.svg.axis()\n                    .scale(this.y)\n                    .orient(\"left\");\n\n                this.x0.domain(this.data.map(d=> { return d.label; }));\n                this.x1.domain(this.options).rangeRoundBands([0, this.x0.rangeBand()]);\n                this.y.domain([0, d3.max(this.data, function(d) { return d3.max(d.valores, d=> { return d.value; }); })]);\n\n                this.svg.append(\"g\")\n                  .attr(\"class\", \"x axis\")\n                  .attr(\"transform\", \"translate(0,\" + this.height + \")\")\n                  .call(this.xAxis);\n\n                this.svg.append(\"g\")\n                  .attr(\"class\", \"y axis\")\n                  .style('opacity','0')\n                  .call(this.yAxis)\n                  .append(\"text\")\n                  .attr(\"transform\", \"rotate(-90)\")\n                  .attr(\"y\", 6)\n                  .attr(\"dy\", \".71em\")\n                  .style(\"text-anchor\", \"end\")\n                  .style('font-weight','bold')\n                  .text(\"Value\");\n            }\n\n            addBar() {\n                let self = this;\n                this.bar = this.svg.selectAll('.bar')\n                    .data(this.data)\n                    .enter().append('g')\n                    .attr('class', 'g')\n                    .attr('transform', d=> {\n                        return `translate(${this.x0(d.label)}, 0)`;\n                    });\n\n                this.barC = this.bar.selectAll('rect')\n                    .data(d=> { return d.valores; })\n                    .enter();\n\n                this.barC.append('rect')\n                    .attr('width', this.x1.rangeBand())\n                    .attr('x', d=> { return this.x1(d.name);})\n                    .attr('y', d=> { return this.y(d.value);})\n                    .attr('height', d=> { return this.height - this.y(d.value);})\n                    .style('fill', d=> { return this.color(d.name);})\n                    .on(\"mouseover\", function(d) {\n                        let color = self.color(d.name);\n                        d3.select(this).style(\"fill\", d3.rgb(color).darker(2));\n                        self.tooltip\n                            .style('opacity', 0.9)\n                            .style('left', (event.pageX - 34) + 'px')\n                            .style('top', (event.pageY - 12) + 'px')\n                            .html(`<strong>${d.name}:</strong><span style='color:red'> ${d.value}</span>`);\n                    })\n                    .on(\"mouseout\", function(d) {\n                        d3.select(this).style(\"fill\", self.color(d.name));\n                        self.tooltip.style('opacity', 0);\n                    });\n            }\n\n            addLegend() {\n                this.legend = this.svg.selectAll('.legend')\n                    .data(this.options.slice())\n                    .enter().append('g')\n                    .attr('class', 'legend')\n                    .attr('transform', (d, i)=> { return `translate(0,${i*20})`; });\n\n                this.legend.append('rect')\n                    .attr('x', this.width*1.1 - 18)\n                    .attr('width', 18)\n                    .attr('height', 18)\n                    .style('fill', this.color);\n\n                this.legend.append('text')\n                    .attr('x', this.width*1.1 - 24)\n                    .attr('y', 9)\n                    .attr('dy', '.35em')\n                    .style('text-anchor', 'end')\n                    .text(d=> { return d; });\n\n                this.legend.transition().duration(500).delay(function(d,i){ return 1300 + 100 * i; }).style(\"opacity\",\"1\");\n            }\n\n            addTooltips() {\n                this.tooltip = d3.select('body').append('div')\n                                    .attr('class', 'tooltip')\n                                    .style('opacity', 0);\n            }\n        }\n\n        function onRender() {\n            if(!ctrl.data) return;\n\n            let Chart = new groupedBarChart({\n                data: ctrl.data,\n                margin: {top: 10, left: 10, bottom: 10, right: 10},\n                element: '#chart',\n                width: ctrl.panel.width,\n                height: ctrl.panel.height,\n                legend: ctrl.panel.legend.show,\n                color: ctrl.panel.colorSch\n            });\n\n            ctrl.panel.colorSet = [];\n            Chart.options.forEach(d=> {\n                ctrl.panel.colorSet.push({text: d, color: Chart.color(d)});\n            });\n        }\n\n        this.events.on('render', function() {\n            onRender();\n        });\n    }\n}\n\nGroupedBarChartCtrl.templateUrl = 'partials/module.html';"]}